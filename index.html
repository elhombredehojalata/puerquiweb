<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carta para Ti</title>

  <!-- FontAwesome for icons (heart icon) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <!-- Confetti library (canvas-confetti) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.2/dist/confetti.browser.min.js"></script>

  <style>
    /* Page styling with repeated background image */
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      text-align: center;
      
      /* Mosaic background with cerdito.jpg */
      background-image: url('cerdito.jpg');
      background-repeat: repeat;
      background-size: 150px 150px; /* Adjust tile size if needed */
    }

    /* Fade-in animation for heading */
    h1 {
      font-size: 2rem;
      margin-bottom: 20px;
      opacity: 0;
      animation: fadeIn 2s forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    /* Carta container with 3D perspective */
    .carta-container {
      position: relative;
      width: 320px; 
      height: 200px;
      cursor: pointer;
      perspective: 1000px; /* 3D effect */
    }

    /* Sobre (envelope) styling */
    .sobre {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: #fdf1e3; /* envelope-like color */
      border-radius: 10px;
      transition: transform 1s;
    }

    /* Tapa (top flap) with heart text “Ábreme” */
    .tapa {
      position: absolute;
      width: 100%;
      height: 50%;
      background-color: #ff4d6d;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      transform-origin: top;
      transition: transform 1s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .tapa p {
      color: #fff;
      font-weight: bold;
      margin: 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* Papel (letter) inside */
    .papel {
      position: absolute;
      width: 90%;
      height: 80%;
      background-color: #fff;
      border-radius: 5px;
      top: 10%;
      left: 5%;
      padding: 10px;
      transform: translateY(100%);
      transition: transform 1s 0.5s, opacity 1s 0.5s;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      overflow-y: auto; /* If text is too long, scroll inside */
    }

    /* When the card is opened, the flap rotates and the paper slides up */
    .carta-container.abierta .tapa {
      transform: rotateX(180deg);
    }
    .carta-container.abierta .papel {
      transform: translateY(0);
      opacity: 1;
    }

    /* We'll place the typewriter text in an empty <p> that we fill with JS */
    #typewriter {
      white-space: pre-wrap; /* So new lines are respected */
      margin: 0;
    }
  </style>
</head>
<body>
  <h1>Te hice esto con mucho amor ❤️</h1>

  <div class="carta-container" onclick="abrirCarta()">
    <!-- Envelope body -->
    <div class="sobre"></div>
    <!-- Envelope flap with text “Ábreme” and heart icon -->
    <div class="tapa">
      <p>
        <span>Ábreme</span>
        <i class="fa fa-heart"></i>
      </p>
    </div>
    <!-- The paper inside the envelope -->
    <div class="papel">
      <!-- We'll type the text into this paragraph via JavaScript -->
      <p id="typewriter"></p>
    </div>
  </div>
  
  <!-- Audio for background music -->
  <audio id="musica" src="brillas.mp3" loop></audio>
  
  <script>
    // If you want to change the text or add more lines, edit 'fullText' below.
    // Use '\\n' for new lines or store your text in a variable.
    const fullText = `Eres lo mejor que me ha pasado.\nTe amo ❤️\nAquí puedes escribir un texto más largo y no se truncará.`;

    // Attempt to play music after page load
    document.addEventListener('DOMContentLoaded', function() {
      let audio = document.getElementById('musica');
      setTimeout(() => {
        audio.play().catch(error => console.log('Autoplay bloqueado, usuario debe interactuar primero.'));
      }, 1000);
    });

    // Attach abrirCarta to window so onclick can find it
    window.abrirCarta = function abrirCarta() {
      let carta = document.querySelector('.carta-container');
      carta.classList.add('abierta');

      let audio = document.getElementById('musica');
      audio.play().catch(err => console.log('Audio blocked:', err));

      // Launch confetti
      lanzarConfeti();

      // Start the typewriter effect once the paper is visible
      setTimeout(() => {
        typeWriter(document.getElementById('typewriter'), fullText);
      }, 500); 
    };

    // Simple confetti using canvas-confetti
    function lanzarConfeti() {
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      });
    }

    /*
      Typewriter effect in JS for multiline text.
      If your text is super long, you can adjust 'typingSpeed'.
    */
    function typeWriter(element, text, i = 0) {
      const typingSpeed = 40; // ms per character
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
        setTimeout(() => typeWriter(element, text, i), typingSpeed);
      }
    }

    /*
      TEST CASES:
      1) Page loads -> 'Te hice esto con mucho amor ❤️' fades in. 
         The code attempts to play music after 1 second. 
         If blocked, user must click the page/carta to allow music.
      2) User clicks on the envelope -> Tapa rotates, papel slides up, 
         the typewriter effect types out the entire 'fullText' (including new lines).
      3) Confetti is launched once the carta is opened.
      4) The entire text is displayed across multiple lines (no truncation).
      5) If user changes 'fullText' to an even longer text, it should still type out fully.
      6) The background is a repeated mosaic of 'cerdito.jpg' sized at 150px x 150px.
      7) Clicking the envelope calls 'abrirCarta()' without errors.
    */
  </script>
</body>
</html>

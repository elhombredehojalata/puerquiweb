<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carta para Ti</title>

  <!-- FontAwesome para iconos (coraz√≥n) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Librer√≠a Confetti (canvas-confetti) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.2/dist/confetti.browser.min.js"></script>

  <style>
    /* Fondo con imagen mosaico + overlay semitransparente */
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      font-family: Arial, sans-serif;
      text-align: center;
      background: 
        linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.35)),
        url('cerdito.jpg');
      background-repeat: repeat;
      background-size: 150px 150px;
    }

    /* Encabezado: centrado, un poco m√°s abajo, con contorno y animaci√≥n */
    h1 {
      position: relative; 
      margin: 30px 0 10px 0; 
      font-size: 1.8rem;
      color: #fff;
      text-shadow: 2px 2px 4px #000;
      opacity: 0;
      animation: fadeIn 2s forwards, pulse 2s infinite;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    /* Animaci√≥n para el emoji coraz√≥n (rebote) */
    .heart {
      display: inline-block;
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }

    /* Contenedor de la carta (sobre) */
    .carta-container {
      position: relative;
      width: 320px;
      height: 200px;
      margin-top: 20px;
      cursor: pointer;
      perspective: 1000px;
    }

    /* Sobre (cuerpo del sobre) */
    .sobre {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: #fdf1e3;
      border-radius: 10px;
      transition: transform 1s;
    }

    /* Tapa del sobre con texto ‚Äú√Åbreme‚Äù */
    .tapa {
      position: absolute;
      width: 100%;
      height: 50%;
      background-color: #ff4d6d;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      transform-origin: top;
      transition: transform 1s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .tapa p {
      color: #fff;
      font-weight: bold;
      margin: 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* Papel (contenido de la carta) */
    .papel {
      position: absolute;
      width: 90%;
      height: 80%;
      background-color: #fff;
      border-radius: 5px;
      top: 10%;
      left: 5%;
      padding: 10px;
      transform: translateY(100%);
      transition: transform 1s 0.5s, opacity 1s 0.5s;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      overflow-y: auto;
    }
    .carta-container.abierta .tapa {
      transform: rotateX(180deg);
    }
    .carta-container.abierta .papel {
      transform: translateY(0);
      opacity: 1;
    }

    /* √Årea de texto con efecto m√°quina de escribir */
    #typewriter {
      white-space: pre-wrap;
      margin: 0;
      text-align: left;
    }

    /* Firma con contorno para destacar */
    #signature {
      margin-top: 20px;
      font-size: 1.5rem;
      font-family: 'Brush Script MT', cursive;
      color: #ff4d6d;
      text-shadow: 2px 2px 4px #000;
      opacity: 0;
      animation: fadeSignature 2s forwards 2s;
    }
    @keyframes fadeSignature {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    /* Efecto parpadeante para "Te amo." final */
    .blinking {
      color: red;
      animation: blinkingText 1s infinite;
      cursor: pointer;
    }
    @keyframes blinkingText {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>

  <!-- Encabezado -->
  <h1>¬°FELICES 4 A√ëOS, CERDA M√çA! <span class="heart">üê∑‚ù§Ô∏è</span></h1>

  <!-- Carta -->
  <div class="carta-container" onclick="abrirCarta()">
    <div class="sobre"></div>
    <div class="tapa">
      <p>
        <span>√Åbreme</span>
        <i class="fa fa-heart"></i>
      </p>
    </div>
    <div class="papel">
      <p id="typewriter"></p>
    </div>
  </div>

  <!-- Firma -->
  <div id="signature">firma: tuhombrede_hojalata</div>

  <!-- Audio -->
  <audio id="musica" src="brillas.mp3" loop></audio>

  <script>
    // Texto completo de la carta; usa "\n\n" para separar p√°rrafos.
    const fullText = `Cuatro a√±os en los que hemos perfeccionado el arte de querernos sin volvernos completamente locos (aunque a veces rozamos la frontera). Dicen que el tiempo vuela cuando se disfruta, pero yo creo que el tiempo simplemente se rinde ante nosotros, porque lo hemos estirado, exprimido y convertido en historias que solo nosotros entendemos.\n\nSiempre he escrito cuentos, hilando palabras para inventar vidas ajenas, tejiendo tramas con personajes que existen solo en el papel. Pero contigo, por primera vez, no necesito ficciones. Lo nuestro se escribe solo, sin esfuerzo, con escenas que no necesitan tinta para quedarse grabadas. No hay finales predecibles ni desenlaces cerrados, solo la certeza de que siempre habr√° una p√°gina m√°s.\n\nSi nuestro amor fuera un libro, tendr√≠a cap√≠tulos ca√≥ticos, di√°logos afilados y giros inesperados‚Ä¶ pero seguir√≠a siendo mi favorito. Gracias por cada p√°gina, por cada l√≠nea y por no tacharme de tu historia. Te amo.`;

    let typewriterStarted = false;

    document.addEventListener('DOMContentLoaded', function() {
      let audio = document.getElementById('musica');
      setTimeout(() => {
        audio.play().catch(error => console.log('Autoplay bloqueado, usuario debe interactuar primero.'));
      }, 1000);
    });

    // Funci√≥n para abrir la carta (solo se ejecuta una vez)
    window.abrirCarta = function abrirCarta() {
      let carta = document.querySelector('.carta-container');
      if (carta.classList.contains('abierta')) return; // Evita reabrir
      carta.classList.add('abierta');
      let audio = document.getElementById('musica');
      audio.play().catch(err => console.log('Audio blocked:', err));
      lanzarConfeti();
      if (!typewriterStarted) {
        setTimeout(() => {
          typeWriter(document.getElementById('typewriter'), fullText);
          typewriterStarted = true;
        }, 500);
      }
    };

    function lanzarConfeti() {
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      });
    }

    // Efecto m√°quina de escribir que soporta texto multil√≠nea
    function typeWriter(element, text, i = 0) {
      const typingSpeed = 40;
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
        setTimeout(() => typeWriter(element, text, i), typingSpeed);
      } else {
        // Al finalizar, reemplaza el √∫ltimo "Te amo." por una versi√≥n parpadeante
        let content = element.textContent;
        element.innerHTML = content.replace(/Te amo\.$/, '<span class="blinking" onclick="lanzarConfeti()">Te amo.</span>');
      }
    }
  </script>
</body>
</html>

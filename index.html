<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carta para Ti</title>

  <!-- FontAwesome for icons (heart icon) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Confetti library (canvas-confetti) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.2/dist/confetti.browser.min.js"></script>

  <style>
    /* Fondo con imagen en mosaico y overlay para oscurecer */
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      text-align: center;
      background: linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.35)),
                  url('cerdito.jpg');
      background-repeat: repeat;
      background-size: 150px 150px;
    }

    /* Encabezado posicionado más arriba con animación */
    h1 {
      position: relative;
      z-index: 10;
      font-size: 2rem;
      margin: 10px 0 30px 0;
      opacity: 0;
      animation: fadeIn 2s forwards, pulse 2s infinite;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    /* Animación para el corazón */
    .heart {
      display: inline-block;
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0); }
    }

    /* Carta container con perspectiva 3D */
    .carta-container {
      position: relative;
      width: 320px;
      height: 200px;
      cursor: pointer;
      perspective: 1000px;
    }

    /* Sobre (cuerpo del sobre) */
    .sobre {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: #fdf1e3;
      border-radius: 10px;
      transition: transform 1s;
    }

    /* Tapa (solapa) del sobre con texto “Ábreme” */
    .tapa {
      position: absolute;
      width: 100%;
      height: 50%;
      background-color: #ff4d6d;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      transform-origin: top;
      transition: transform 1s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .tapa p {
      color: #fff;
      font-weight: bold;
      margin: 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* Papel (contenido de la carta) */
    .papel {
      position: absolute;
      width: 90%;
      height: 80%;
      background-color: #fff;
      border-radius: 5px;
      top: 10%;
      left: 5%;
      padding: 10px;
      transform: translateY(100%);
      transition: transform 1s 0.5s, opacity 1s 0.5s;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      overflow-y: auto;
    }
    /* Al abrir la carta */
    .carta-container.abierta .tapa {
      transform: rotateX(180deg);
    }
    .carta-container.abierta .papel {
      transform: translateY(0);
      opacity: 1;
    }

    /* Área para el texto con efecto máquina de escribir (se rellenará vía JS) */
    #typewriter {
      white-space: pre-wrap;
      margin: 0;
    }
  </style>
</head>
<body>
  <!-- Encabezado superior -->
  <h1>Te hice esto con mucho amor <span class="heart">❤️</span></h1>

  <!-- Contenedor de la carta -->
  <div class="carta-container" onclick="abrirCarta()">
    <div class="sobre"></div>
    <div class="tapa">
      <p>
        <span>Ábreme</span>
        <i class="fa fa-heart"></i>
      </p>
    </div>
    <div class="papel">
      <p id="typewriter"></p>
    </div>
  </div>
  
  <!-- Audio de fondo -->
  <audio id="musica" src="brillas.mp3" loop></audio>
  
  <script>
    // Texto completo a mostrar (puedes modificarlo por uno más largo)
    const fullText = `Eres lo mejor que me ha pasado.\nTe amo ❤️\nAquí puedes escribir un texto más largo y no se truncará.`;

    // Se intenta reproducir la música después de cargar la página
    document.addEventListener('DOMContentLoaded', function() {
      let audio = document.getElementById('musica');
      setTimeout(() => {
        audio.play().catch(error => console.log('Autoplay bloqueado, usuario debe interactuar primero.'));
      }, 1000);
    });

    // La función se ejecuta solo una vez al hacer click (si la carta no está ya abierta)
    window.abrirCarta = function abrirCarta() {
      let carta = document.querySelector('.carta-container');
      if (carta.classList.contains('abierta')) return; // Evita regenerar el texto
      carta.classList.add('abierta');

      let audio = document.getElementById('musica');
      audio.play().catch(err => console.log('Audio blocked:', err));

      lanzarConfeti();

      // Inicia el efecto de máquina de escribir una sola vez
      setTimeout(() => {
        typeWriter(document.getElementById('typewriter'), fullText);
      }, 500);
    };

    // Confetti con canvas-confetti
    function lanzarConfeti() {
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      });
    }

    // Efecto máquina de escribir para texto multilínea
    function typeWriter(element, text, i = 0) {
      const typingSpeed = 40; // velocidad en ms por caracter
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
        setTimeout(() => typeWriter(element, text, i), typingSpeed);
      }
    }

    /* TEST CASES:
       1) Al cargar la página, se muestra el encabezado animado en la parte superior.
       2) El fondo muestra la imagen "cerdito.jpg" en mosaico con overlay oscuro.
       3) Al hacer click en la carta (solo la primera vez), la solapa rota, el papel se desliza y aparece el texto completo con efecto de máquina de escribir.
       4) Se lanza confetti al abrir la carta.
       5) Si se hace click nuevamente, no se vuelve a generar el texto.
    */
  </script>
</body>
</html>

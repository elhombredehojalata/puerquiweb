<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carta para Ti</title>

  <!-- FontAwesome para iconos (coraz√≥n) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Librer√≠a Confetti (canvas-confetti) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.2/dist/confetti.browser.min.js"></script>

  <style>
    /* Fondo con imagen mosaico + overlay semitransparente */
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      font-family: Arial, sans-serif;
      text-align: center;
      background: 
        linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.35)),
        url('cerdito.jpg');
      background-repeat: repeat;
      background-size: 150px 150px;
    }

    /* Encabezado: centrado, con contorno, animaci√≥n y posicionado un poco abajo */
    h1 {
      position: relative; 
      margin: 30px 0 10px 0; 
      font-size: 1.8rem;
      color: #fff;
      text-shadow: 2px 2px 4px #000;
      opacity: 0;
      animation: fadeIn 2s forwards, pulse 2s infinite;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    /* Animaci√≥n para el emoji coraz√≥n (rebote) */
    .heart {
      display: inline-block;
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }

    /* Contenedor de la carta (sobre) */
    .carta-container {
      position: relative;
      width: 320px;
      height: 200px;
      margin-top: 20px;
      cursor: pointer;
      perspective: 1000px;
    }

    /* Sobre (cuerpo del sobre) */
    .sobre {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: #fdf1e3;
      border-radius: 10px;
      transition: transform 1s;
    }

    /* Tapa del sobre con texto ‚Äú√Åbreme‚Äù */
    .tapa {
      position: absolute;
      width: 100%;
      height: 50%;
      background-color: #ff4d6d;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      transform-origin: top;
      transition: transform 1s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .tapa p {
      color: #fff;
      font-weight: bold;
      margin: 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* Papel (contenido de la carta) */
    .papel {
      position: absolute;
      width: 90%;
      height: 80%;
      background-color: #fff;
      border-radius: 5px;
      top: 10%;
      left: 5%;
      padding: 10px;
      transform: translateY(100%);
      transition: transform 1s 0.5s, opacity 1s 0.5s;
      /* Cambiado para que el contenido se alinee al inicio */
      display: block;
      overflow-y: auto;
      text-align: left;
    }
    .carta-container.abierta .tapa {
      transform: rotateX(180deg);
    }
    .carta-container.abierta .papel {
      transform: translateY(0);
      opacity: 1;
    }

    /* √Årea de texto con efecto m√°quina de escribir */
    #typewriter {
      white-space: pre-wrap;
      margin: 0;
    }

    /* Firma: color blanco con contorno negro */
    #signature {
      margin-top: 20px;
      font-size: 1.5rem;
      font-family: 'Brush Script MT', cursive;
      color: #fff;
      text-shadow: 2px 2px 4px black;
      opacity: 0;
      animation: fadeSignature 2s forwards 2s;
    }
    @keyframes fadeSignature {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    /* Efecto parpadeante para "Te amo." */
    .blinking {
      color: red;
      animation: blinkingText 1s infinite;
      cursor: pointer;
    }
    @keyframes blinkingText {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }
    /* Aclaraci√≥n para "Te amo" */
    .clarification {
      font-size: 0.8rem;
      color: #fff;
      font-style: italic;
      margin-left: 5px;
    }

    /* Texto final adicional en la carta */
    .postscript {
      font-style: italic;
      margin-top: 10px;
      color: #333;
    }

    /* Estilos para la galer√≠a */
    #gallery-box {
      margin-top: 30px;
      padding: 15px;
      width: 320px;
      background-color: #fdf1e3;
      border: 2px solid #ff4d6d;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #gallery-box:hover {
      background-color: #ffeccf;
    }
    #gallery-box p {
      margin: 0;
      font-size: 1rem;
      font-weight: bold;
      color: #333;
    }
    /* Contenedor de la galer√≠a (inicialmente oculto) */
    #gallery-container {
      display: none;
      margin-top: 20px;
      width: 320px;
    }
    #gallery-main {
      width: 100%;
      height: auto;
      text-align: center;
    }
    #gallery-main img {
      width: 100%;
      max-width: 320px;
      height: auto;
      transition: all 1s ease;
    }
    #gallery-thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
      justify-content: center;
    }
    #gallery-thumbs img {
      width: 80px;
      height: auto;
      opacity: 0.8;
      transition: all 0.5s ease;
    }

    /* Nueva cajita: ‚ÄúTe cuento que‚Ä¶‚Äù */
    #info-box {
      margin-top: 20px;
      width: 320px;
      background-color: #fdf1e3;
      border: 2px solid #ff4d6d;
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #info-box:hover {
      background-color: #ffeccf;
    }
    #info-box p {
      margin: 0;
      font-size: 1rem;
      font-weight: bold;
      color: #333;
    }
    /* Contenedor oculto para el texto de ‚ÄúTe cuento que‚Ä¶‚Äù */
    #info-container {
      display: none;
      margin-top: 10px;
      width: 320px;
      background-color: #fff;
      border: 2px solid #ff4d6d;
      border-radius: 10px;
      padding: 15px;
      position: relative;
      animation: fadeInBox 1s forwards;
    }
    @keyframes fadeInBox {
      from { opacity: 0; transform: translateY(-10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    #info-text {
      font-size: 0.9rem;
      color: #333;
      margin-bottom: 10px;
    }
    #info-button {
      background-color: #ff4d6d;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }
    #info-button:hover {
      background-color: #ff2f51;
    }
    /* Mensaje al copiar link */
    #info-message {
      margin-top: 10px;
      color: #ff4d6d;
      font-size: 1rem;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
      animation: happyMessage 0.5s alternate infinite ease-in-out;
    }
    @keyframes happyMessage {
      0% { transform: scale(1); }
      100% { transform: scale(1.1); }
    }
  </style>
</head>
<body>

  <!-- Encabezado -->
  <h1>¬°FELICES 4 A√ëOS, CERDA M√çA! <span class="heart">üê∑‚ù§Ô∏è</span></h1>

  <!-- Carta -->
  <div class="carta-container" onclick="abrirCarta()">
    <div class="sobre"></div>
    <div class="tapa">
      <p>
        <span>√Åbreme</span>
        <i class="fa fa-heart"></i>
      </p>
    </div>
    <div class="papel">
      <p id="typewriter"></p>
    </div>
  </div>

  <!-- Firma -->
  <div id="signature">firma: tuhombrede_hojalata</div>

  <!-- Audio -->
  <audio id="musica" src="brillas.mp3" loop></audio>

  <!-- Galer√≠a: Caja inicial -->
  <div id="gallery-box" onclick="openGallery()">
    <p>Click aqu√≠ para revivir algunos recuerdos de estos hermosos 4 a√±os que me regalaste.</p>
  </div>

  <!-- Galer√≠a: Contenedor oculto -->
  <div id="gallery-container">
    <div id="gallery-main"></div>
    <div id="gallery-thumbs"></div>
  </div>

  <!-- Nueva cajita ‚ÄúTe cuento que‚Ä¶‚Äù -->
  <div id="info-box" onclick="openInfo()">
    <p>Te cuento que...</p>
  </div>

  <!-- Contenedor del texto y bot√≥n para copiar enlace -->
  <div id="info-container">
    <div id="info-text">
      si decides conservar el link de esta p√°gina, este recuerdo ser√° guardado por siempre y lo podr√°s ver cuando quieras, as√≠ recordar√°s cu√°nto te amo con solo un click
    </div>
    <button id="info-button" onclick="copyLink(event)">guardar enlace</button>
    <div id="info-message"></div>
  </div>

  <script>
    // Texto completo de la carta; usa "\n\n" para separar p√°rrafos.
    const fullText = `Cuatro a√±os en los que hemos perfeccionado el arte de querernos sin volvernos completamente locos (aunque a veces rozamos la frontera). Dicen que el tiempo vuela cuando se disfruta, pero yo creo que el tiempo simplemente se rinde ante nosotros, porque lo hemos estirado, exprimido y convertido en historias que solo nosotros entendemos.\n\nSiempre he escrito cuentos, hilando palabras para inventar vidas ajenas, tejiendo tramas con personajes que existen solo en el papel. Pero contigo, por primera vez, no necesito ficciones. Lo nuestro se escribe solo, sin esfuerzo, con escenas que no necesitan tinta para quedarse grabadas. No hay finales predecibles ni desenlaces cerrados, solo la certeza de que siempre habr√° una p√°gina m√°s.\n\nSi nuestro amor fuera un libro, tendr√≠a cap√≠tulos ca√≥ticos, di√°logos afilados y giros inesperados‚Ä¶ pero seguir√≠a siendo mi favorito. Gracias por cada p√°gina, por cada l√≠nea y por no tacharme de tu historia. Te amo.`;
    
    let typewriterStarted = false;
    let userScrolled = false; // Flag para detectar desplazamiento manual
    let cartaAbierta = false; // Para saber si la carta ya fue abierta

    document.addEventListener('DOMContentLoaded', function() {
      const papel = document.querySelector('.papel');
      // Detecta scroll manual en el contenedor de la carta
      papel.addEventListener('scroll', function() {
        userScrolled = true;
      });

      let audio = document.getElementById('musica');
      setTimeout(() => {
        audio.play().catch(error => console.log('Autoplay bloqueado, usuario debe interactuar primero.'));
      }, 1000);
    });

    // Abre la carta (solo la primera vez)
    window.abrirCarta = function abrirCarta() {
      let carta = document.querySelector('.carta-container');
      if (carta.classList.contains('abierta')) return;
      carta.classList.add('abierta');
      cartaAbierta = true;

      let audio = document.getElementById('musica');
      audio.play().catch(err => console.log('Audio blocked:', err));
      lanzarConfeti();

      if (!typewriterStarted) {
        setTimeout(() => {
          typeWriter(document.getElementById('typewriter'), fullText);
          typewriterStarted = true;
        }, 500);
      }
    };

    // Confetti
    function lanzarConfeti() {
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      });
    }

    // Efecto de m√°quina de escribir (m√°s lento) con auto-scroll condicional.
    function typeWriter(element, text, i = 0) {
      const typingSpeed = 80;
      if (i < text.length) {
        element.textContent += text.charAt(i);
        // Auto-scroll: si el usuario no ha desplazado manualmente y est√° cerca del fondo, se desplaza.
        if (!userScrolled && isNearBottom(element.parentElement)) {
          element.parentElement.scrollTop = element.parentElement.scrollHeight;
        }
        i++;
        setTimeout(() => typeWriter(element, text, i), typingSpeed);
      } else {
        // Al finalizar, se reemplaza "Te amo." con parpadeo, se a√±ade la aclaraci√≥n y "Postada: Haz click en el 'Te amo'".
        let content = element.textContent;
        element.innerHTML = content.replace(
          /Te amo\.$/,
          '<span class="blinking" onclick="lanzarConfeti()">Te amo.</span>' +
          '<span class="clarification">(haz click en \'Te amo\')</span><br><em>Postada: Haz click en el "Te amo"</em>'
        );
        // Una vez finalizada la animaci√≥n, forzamos el scroll al inicio.
        element.parentElement.scrollTop = 0;
        // Se permite el scroll manual (desactivamos el auto-scroll)
        userScrolled = true;
      }
    }

    // Verifica si el usuario est√° cerca del fondo
    function isNearBottom(container) {
      const threshold = 10;
      return container.scrollHeight - container.scrollTop - container.clientHeight < threshold;
    }

    // Abre la galer√≠a
    function openGallery() {
      if (!cartaAbierta) {
        alert("Tranquila, puerquita, primero lee la carta y despu√©s ves esto ü§£‚ù§Ô∏è");
        return;
      }
      document.getElementById('gallery-box').style.display = 'none';
      document.getElementById('gallery-container').style.display = 'block';
      startGallery();
    }

    // Variables para la galer√≠a
    let currentImage = 1;
    const totalImages = 24;

    // Inicia la galer√≠a: muestra cada imagen y luego la minimiza a miniatura.
    function startGallery() {
      if (currentImage > totalImages) return;
      const galleryMain = document.getElementById('gallery-main');
      galleryMain.innerHTML = '';
      let img = document.createElement('img');
      img.src = currentImage + ".jpg";
      img.style.width = "100%";
      img.style.maxWidth = "320px";
      img.style.height = "auto";
      galleryMain.appendChild(img);
      setTimeout(() => {
        img.style.width = "80px";
        img.style.opacity = "0.8";
        setTimeout(() => {
          const galleryThumbs = document.getElementById('gallery-thumbs');
          galleryThumbs.appendChild(img);
          currentImage++;
          startGallery();
        }, 1000);
      }, 3000);
    }

    // Abre la cajita ‚ÄúTe cuento que‚Ä¶‚Äù
    function openInfo() {
      const infoContainer = document.getElementById('info-container');
      if (infoContainer.style.display === 'block') return;
      infoContainer.style.display = 'block';
    }

    // Copia el enlace y muestra el mensaje
    function copyLink(event) {
      event.stopPropagation();
      navigator.clipboard.writeText('https://elhombredehojalata.github.io/puerquiweb')
        .then(() => {
          document.getElementById('info-message').textContent =
            'gracias por guardar nuestros puerquirecuerdos, te amo üê∑‚ù§Ô∏è';
        })
        .catch(err => console.log('Error al copiar enlace:', err));
    }
  </script>
</body>
</html>
